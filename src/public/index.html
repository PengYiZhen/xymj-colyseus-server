<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°æ¸¸ç åŒ  - å¤šäººåœ¨çº¿æ¸¸æˆæœåŠ¡ç«¯æ¡†æ¶</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            padding: 40px 20px;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 3em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .card {
            background: white;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 12px rgba(0,0,0,0.15);
        }

        .card h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.8em;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .card h3 {
            color: #764ba2;
            margin: 20px 0 10px 0;
            font-size: 1.3em;
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .feature-item {
            background: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .feature-item .icon {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .api-endpoint {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }

        .method {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 4px;
            font-weight: bold;
            font-size: 0.9em;
            margin-right: 10px;
        }

        .method.post {
            background: #28a745;
            color: white;
        }

        .method.get {
            background: #007bff;
            color: white;
        }

        .endpoint-path {
            font-family: 'Courier New', monospace;
            font-size: 1.1em;
            color: #333;
        }

        .description {
            margin: 10px 0;
            color: #666;
        }

        .request-example {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }

        .response-example {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }

        .status-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 3px;
            font-size: 0.85em;
            margin-left: 10px;
        }

        .status-success {
            background: #d4edda;
            color: #155724;
        }

        .status-info {
            background: #d1ecf1;
            color: #0c5460;
        }

        .status-warning {
            background: #fff3cd;
            color: #856404;
        }

        .try-button {
            background: #667eea;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9em;
            margin-top: 10px;
            transition: background 0.3s ease;
        }

        .try-button:hover {
            background: #764ba2;
        }

        .footer {
            text-align: center;
            color: white;
            padding: 20px;
            margin-top: 40px;
        }

        .badge {
            display: inline-block;
            background: rgba(255,255,255,0.2);
            padding: 4px 12px;
            border-radius: 12px;
            margin: 0 5px;
            font-size: 0.9em;
        }

        code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }

        .swagger-button {
            display: inline-block;
            background: #28a745;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: bold;
            margin-top: 20px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
        }

        .swagger-button:hover {
            background: #218838;
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(0,0,0,0.3);
        }

        .swagger-button:active {
            transform: translateY(0);
        }

        .swagger-link {
            color: #28a745;
            text-decoration: none;
            font-weight: bold;
            border-bottom: 2px solid #28a745;
            transition: all 0.3s ease;
        }

        .swagger-link:hover {
            color: #218838;
            border-bottom-color: #218838;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ® å°æ¸¸ç åŒ -<span style="font-size:40px;">å¾®ä¿¡å…¬ä¼—å·</span></h1>
            <p>å¤šäººåœ¨çº¿æ¸¸æˆæœåŠ¡ç«¯æ¡†æ¶</p>
            <div style="margin-top: 20px;">
                <span class="badge">Colyseus</span>
                <span class="badge">TypeORM</span>
                <span class="badge">Redis</span>
                <span class="badge">JWT</span>
                <span class="badge">MVC</span>
                <span class="badge">Swagger</span>
            </div>
            <a href="/api-docs" class="swagger-button" target="_blank">
                ğŸ“š æŸ¥çœ‹ Swagger API æ–‡æ¡£
            </a>
        </div>

        <div class="card">
            <h2>âœ¨ æ¡†æ¶ç‰¹æ€§</h2>
            <div class="feature-grid">
                <div class="feature-item">
                    <div class="icon">ğŸ—ï¸</div>
                    <h3>MVC æ¶æ„</h3>
                    <p>æ¸…æ™°çš„æ§åˆ¶å™¨ã€æœåŠ¡ã€æ¨¡å‹åˆ†å±‚</p>
                </div>
                <div class="feature-item">
                    <div class="icon">ğŸ”</div>
                    <h3>JWT è®¤è¯</h3>
                    <p>å®Œæ•´çš„ä»¤ç‰Œç”Ÿæˆã€éªŒè¯å’Œåˆ·æ–°æœºåˆ¶</p>
                </div>
                <div class="feature-item">
                    <div class="icon">ğŸ’¾</div>
                    <h3>TypeORM</h3>
                    <p>å¼ºå¤§çš„ ORM æ•°æ®åº“æ“ä½œ</p>
                </div>
                <div class="feature-item">
                    <div class="icon">âš¡</div>
                    <h3>Redis ç¼“å­˜</h3>
                    <p>é«˜æ€§èƒ½ç¼“å­˜æ”¯æŒ</p>
                </div>
                <div class="feature-item">
                    <div class="icon">âœ…</div>
                    <h3>æ•°æ®éªŒè¯</h3>
                    <p>åŸºäº class-validator çš„è¯·æ±‚éªŒè¯</p>
                </div>
                <div class="feature-item">
                    <div class="icon">ğŸ›¡ï¸</div>
                    <h3>é”™è¯¯å¤„ç†</h3>
                    <p>ç»Ÿä¸€çš„é”™è¯¯å¤„ç†ä¸­é—´ä»¶</p>
                </div>
                <div class="feature-item">
                    <div class="icon">ğŸ“š</div>
                    <h3>Swagger æ–‡æ¡£</h3>
                    <p>è‡ªåŠ¨ç”Ÿæˆ API æ–‡æ¡£å’Œäº¤äº’å¼æµ‹è¯•</p>
                </div>
                <div class="feature-item">
                    <div class="icon">âš™ï¸</div>
                    <h3>å¸§åŒæ­¥</h3>
                    <p>å¤šäººæ¸¸æˆå¸§åŒæ­¥æœºåˆ¶ï¼Œç¡®ä¿æ¸¸æˆçŠ¶æ€ä¸€è‡´æ€§</p>
                    <a href="FrameSync.html" style="display: inline-block; margin-top: 10px; color: #667eea; text-decoration: none; font-size: 0.9em;">
                        ğŸ® ä½“éªŒæ¼”ç¤º â†’
                    </a>
                </div>
            </div>
        </div>

        <div class="card">
            <h2>ğŸ“¡ ç”¨æˆ·è®¤è¯ API æ¥å£</h2>

            <div class="api-endpoint">
                <div>
                    <span class="method post">POST</span>
                    <span class="endpoint-path">/api/auth/register</span>
                    <span class="status-badge status-info">ç”¨æˆ·æ³¨å†Œ</span>
                </div>
                <div class="description">
                    æ³¨å†Œæ–°ç”¨æˆ·è´¦æˆ·
                </div>
                <div>
                    <strong>è¯·æ±‚å‚æ•°ï¼š</strong>
                    <div class="request-example">{
  "username": "testuser",
  "email": "test@example.com",
  "password": "password123",
  "nickname": "æµ‹è¯•ç”¨æˆ·"  // å¯é€‰
}</div>
                </div>
                <div>
                    <strong>å“åº”ç¤ºä¾‹ï¼š</strong>
                    <div class="response-example">{
  "success": true,
  "message": "æ³¨å†ŒæˆåŠŸ",
  "data": {
    "user": {
      "id": "uuid",
      "username": "testuser",
      "email": "test@example.com",
      "nickname": "æµ‹è¯•ç”¨æˆ·"
    },
    "tokens": {
      "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
      "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
    }
  }
}</div>
                </div>
                <button class="try-button" onclick="tryApi('POST', '/api/auth/register', {
  username: 'testuser',
  email: 'test@example.com',
  password: 'password123',
  nickname: 'æµ‹è¯•ç”¨æˆ·'
})">å°è¯•è°ƒç”¨</button>
            </div>

            <div class="api-endpoint">
                <div>
                    <span class="method post">POST</span>
                    <span class="endpoint-path">/api/auth/login</span>
                    <span class="status-badge status-success">ç”¨æˆ·ç™»å½•</span>
                </div>
                <div class="description">
                    ç”¨æˆ·ç™»å½•è·å–è®¿é—®ä»¤ç‰Œ
                </div>
                <div>
                    <strong>è¯·æ±‚å‚æ•°ï¼š</strong>
                    <div class="request-example">{
  "username": "testuser",  // å¯ä»¥æ˜¯ç”¨æˆ·åæˆ–é‚®ç®±
  "password": "password123"
}</div>
                </div>
                <div>
                    <strong>å“åº”ç¤ºä¾‹ï¼š</strong>
                    <div class="response-example">{
  "success": true,
  "message": "ç™»å½•æˆåŠŸ",
  "data": {
    "user": {
      "id": "uuid",
      "username": "testuser",
      "email": "test@example.com"
    },
    "tokens": {
      "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
      "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
    }
  }
}</div>
                </div>
                <button class="try-button" onclick="tryApi('POST', '/api/auth/login', {
  username: 'testuser',
  password: 'password123'
})">å°è¯•è°ƒç”¨</button>
            </div>

            <div class="api-endpoint">
                <div>
                    <span class="method post">POST</span>
                    <span class="endpoint-path">/api/auth/refresh</span>
                    <span class="status-badge status-info">åˆ·æ–°ä»¤ç‰Œ</span>
                </div>
                <div class="description">
                    ä½¿ç”¨åˆ·æ–°ä»¤ç‰Œè·å–æ–°çš„è®¿é—®ä»¤ç‰Œ
                </div>
                <div>
                    <strong>è¯·æ±‚å‚æ•°ï¼š</strong>
                    <div class="request-example">{
  "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}</div>
                </div>
                <div>
                    <strong>å“åº”ç¤ºä¾‹ï¼š</strong>
                    <div class="response-example">{
  "success": true,
  "message": "åˆ·æ–°ä»¤ç‰ŒæˆåŠŸ",
  "data": {
    "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
  }
}</div>
                </div>
                <button class="try-button" onclick="tryRefreshToken()">å°è¯•è°ƒç”¨</button>
            </div>

            <div class="api-endpoint">
                <div>
                    <span class="method get">GET</span>
                    <span class="endpoint-path">/api/auth/me</span>
                    <span class="status-badge status-warning">éœ€è¦è®¤è¯</span>
                </div>
                <div class="description">
                    è·å–å½“å‰ç™»å½•ç”¨æˆ·ä¿¡æ¯ï¼ˆéœ€è¦åœ¨è¯·æ±‚å¤´ä¸­æºå¸¦ <code>Authorization: Bearer &lt;accessToken&gt;</code>ï¼‰
                </div>
                <div>
                    <strong>è¯·æ±‚å¤´ï¼š</strong>
                    <div class="request-example">Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...</div>
                </div>
                <div>
                    <strong>å“åº”ç¤ºä¾‹ï¼š</strong>
                    <div class="response-example">{
  "success": true,
  "message": "è·å–æˆåŠŸ",
  "data": {
    "id": "uuid",
    "username": "testuser",
    "email": "test@example.com",
    "nickname": "æµ‹è¯•ç”¨æˆ·",
    "avatar": null,
    "status": 1,
    "createdAt": "2024-01-01T00:00:00.000Z",
    "updatedAt": "2024-01-01T00:00:00.000Z"
  }
}</div>
                </div>
                <button class="try-button" onclick="tryApi('GET', '/api/auth/me', null, true)">å°è¯•è°ƒç”¨</button>
            </div>
        </div>

        <div class="card">
            <h2>ğŸ”§ å…¶ä»–æ¥å£</h2>
            <div class="api-endpoint">
                <div>
                    <span class="method get">GET</span>
                    <span class="endpoint-path">/health</span>
                    <span class="status-badge status-success">å¥åº·æ£€æŸ¥</span>
                </div>
                <div class="description">
                    æ£€æŸ¥æœåŠ¡è¿è¡ŒçŠ¶æ€
                </div>
                <div>
                    <strong>å“åº”ç¤ºä¾‹ï¼š</strong>
                    <div class="response-example">{
  "success": true,
  "message": "æœåŠ¡è¿è¡Œæ­£å¸¸",
  "timestamp": "2024-01-01T00:00:00.000Z",
  "version": "1.0.0"
}</div>
                </div>
                <button class="try-button" onclick="tryApi('GET', '/health')">å°è¯•è°ƒç”¨</button>
            </div>
            
            <div class="api-endpoint" style="background: #e8f5e9; border-left-color: #28a745;">
                <div>
                    <span class="method get" style="background: #28a745;">GET</span>
                    <span class="endpoint-path">/api-docs</span>
                    <span class="status-badge status-success">Swagger æ–‡æ¡£</span>
                </div>
                <div class="description">
                    æŸ¥çœ‹å®Œæ•´çš„ API æ–‡æ¡£å’Œäº¤äº’å¼æµ‹è¯•ç•Œé¢
                </div>
                <div style="margin-top: 15px;">
                    <a href="/api-docs" class="swagger-link" target="_blank">
                        ğŸ“š æ‰“å¼€ Swagger API æ–‡æ¡£ â†’
                    </a>
                </div>
            </div>
        </div>

        <div class="card">
            <h2>âš™ï¸ å¸§åŒæ­¥æ¼”ç¤º</h2>
            <div class="api-endpoint" style="background: #fff4e6; border-left-color: #ff9800;">
                <div>
                    <span class="method get" style="background: #ff9800;">DEMO</span>
                    <span class="endpoint-path">FrameSync.html</span>
                    <span class="status-badge status-info">äº¤äº’å¼æ¼”ç¤º</span>
                </div>
                <div class="description">
                    æ‰“å¼€å¸§åŒæ­¥åŠŸèƒ½çš„äº¤äº’å¼æ¼”ç¤ºç¨‹åºï¼Œå¯ä»¥å®æ—¶æµ‹è¯•å¸§åŒæ­¥åŠŸèƒ½
                </div>
                <div style="margin-top: 15px;">
                    <a href="FrameSync.html" class="swagger-link" style="color: #ff9800; border-bottom-color: #ff9800;">
                        ğŸ® æ‰“å¼€å¸§åŒæ­¥æ¼”ç¤ºç¨‹åº â†’
                    </a>
                </div>
            </div>
        </div>

        <div class="card">
            <h2>âš™ï¸ å¸§åŒæ­¥åŠŸèƒ½</h2>
            <div class="description" style="margin-bottom: 20px;">
                å¸§åŒæ­¥ï¼ˆFrame Synchronizationï¼‰æ˜¯ä¸€ç§å¤šäººæ¸¸æˆåŒæ­¥æœºåˆ¶ï¼Œç¡®ä¿æ‰€æœ‰å®¢æˆ·ç«¯åœ¨ç›¸åŒçš„å¸§ä¸Šæ‰§è¡Œç›¸åŒçš„é€»è¾‘ï¼Œä»è€Œä¿è¯æ¸¸æˆçŠ¶æ€çš„ä¸€è‡´æ€§ã€‚
            </div>

            <h3 style="color: #667eea; margin-top: 20px; margin-bottom: 10px;">æ ¸å¿ƒç‰¹æ€§</h3>
            <ul style="list-style: none; padding-left: 0;">
                <li style="margin: 10px 0; padding-left: 25px; position: relative;">
                    <span style="position: absolute; left: 0;">âœ…</span>
                    <strong>å›ºå®šå¸§ç‡</strong>ï¼šå¯é…ç½®çš„ç›®æ ‡ FPSï¼ˆé»˜è®¤ 20 FPSï¼‰
                </li>
                <li style="margin: 10px 0; padding-left: 25px; position: relative;">
                    <span style="position: absolute; left: 0;">âœ…</span>
                    <strong>è¾“å…¥åŒæ­¥</strong>ï¼šè‡ªåŠ¨æ”¶é›†å’ŒåŒæ­¥å®¢æˆ·ç«¯è¾“å…¥
                </li>
                <li style="margin: 10px 0; padding-left: 25px; position: relative;">
                    <span style="position: absolute; left: 0;">âœ…</span>
                    <strong>å¸§æ•°æ®è®°å½•</strong>ï¼šæ”¯æŒè®°å½•å¸§æ•°æ®ç”¨äºå›æ”¾
                </li>
                <li style="margin: 10px 0; padding-left: 25px; position: relative;">
                    <span style="position: absolute; left: 0;">âœ…</span>
                    <strong>å»¶è¿Ÿæ£€æµ‹</strong>ï¼šè‡ªåŠ¨æ£€æµ‹å¸§å»¶è¿Ÿå¹¶è­¦å‘Š
                </li>
            </ul>

            <h3 style="color: #667eea; margin-top: 30px; margin-bottom: 10px;">ä½¿ç”¨ç¤ºä¾‹</h3>
            <div class="api-endpoint" style="background: #f0f4ff; border-left-color: #667eea;">
                <div class="description">
                    <strong>æœåŠ¡ç«¯ä»£ç ï¼š</strong>
                </div>
                <div class="request-example" style="background: #2d2d2d; color: #f8f8f2; margin-top: 10px;">
import { FrameSyncRoom, ClientInput } from "../utils/FrameSync";

export class GameRoom extends FrameSyncRoom&lt;MyRoomState&gt; {
  onCreate(options: any) {
    // åˆå§‹åŒ–å¸§åŒæ­¥ï¼ˆ20 FPSï¼‰
    this.initFrameSync({
      targetFPS: 20,
      enabled: true,
    });
    
    // å¯åŠ¨å¸§åŒæ­¥
    this.startFrameSync();
  }

  // å®ç°å¸§æ›´æ–°é€»è¾‘
  protected onFrameUpdate(frame: number, inputs: ClientInput[]) {
    // å¤„ç†æ‰€æœ‰å®¢æˆ·ç«¯çš„è¾“å…¥
    for (const input of inputs) {
      this.processPlayerInput(input);
    }
  }

  // å®ç°å¸§åŒæ­¥é€»è¾‘
  protected onFrameSync(frame: number, frameData: any) {
    // åŒæ­¥çŠ¶æ€åˆ°å®¢æˆ·ç«¯
    this.state.frame = frame;
  }
}
                </div>
            </div>

            <div class="api-endpoint" style="background: #f0f4ff; border-left-color: #667eea; margin-top: 15px;">
                <div class="description">
                    <strong>å®¢æˆ·ç«¯ä»£ç ï¼š</strong>
                </div>
                <div class="request-example" style="background: #2d2d2d; color: #f8f8f2; margin-top: 10px;">
// è¿æ¥æˆ¿é—´
const room = await client.joinOrCreate("game_room", { fps: 20 });

// å‘é€è¾“å…¥
room.send("input", {
  inputs: {
    move: { x: 1, y: 0 },
    attack: false,
  }
});

// æ¥æ”¶å¸§åŒæ­¥ä¿¡æ¯
room.onMessage("frameSync", (message) => {
  console.log("å½“å‰å¸§:", message.currentFrame);
  console.log("ç›®æ ‡FPS:", message.targetFPS);
});
                </div>
            </div>

            <h3 style="color: #667eea; margin-top: 30px; margin-bottom: 10px;">æˆ¿é—´ç±»å‹</h3>
            <div class="api-endpoint" style="background: #fff4e6; border-left-color: #ff9800;">
                <div>
                    <span class="method get" style="background: #ff9800;">ROOM</span>
                    <span class="endpoint-path">game_room</span>
                    <span class="status-badge status-info">å¸§åŒæ­¥æˆ¿é—´</span>
                </div>
                <div class="description">
                    ä½¿ç”¨å¸§åŒæ­¥æœºåˆ¶çš„æ¸¸æˆæˆ¿é—´ï¼Œæ”¯æŒå¤šäººå®æ—¶åŒæ­¥
                </div>
                <div style="margin-top: 10px;">
                    <strong>è¿æ¥å‚æ•°ï¼š</strong>
                    <div class="request-example" style="background: #fff4e6; color: #333; margin-top: 5px;">
{
  "fps": 20,              // ç›®æ ‡å¸§ç‡ï¼ˆå¯é€‰ï¼Œé»˜è®¤ 20ï¼‰
  "recordFrames": false   // æ˜¯å¦è®°å½•å¸§æ•°æ®ï¼ˆå¯é€‰ï¼‰
}
                    </div>
                </div>
            </div>

            <h3 style="color: #667eea; margin-top: 30px; margin-bottom: 10px;">é…ç½®é€‰é¡¹</h3>
            <div class="response-example" style="margin-top: 10px;">
{
  "targetFPS": 20,        // ç›®æ ‡å¸§ç‡ï¼ˆé»˜è®¤ï¼š20ï¼‰
  "enabled": true,         // æ˜¯å¦å¯ç”¨ï¼ˆé»˜è®¤ï¼štrueï¼‰
  "maxFrameDelay": 100,    // æœ€å¤§å¸§å»¶è¿Ÿï¼Œå•ä½ï¼šæ¯«ç§’ï¼ˆé»˜è®¤ï¼š100ï¼‰
  "recordFrames": false    // æ˜¯å¦è®°å½•å¸§æ•°æ®ï¼ˆé»˜è®¤ï¼šfalseï¼‰
}
            </div>
        </div>

        <div class="footer">
            <p>Â© 2024 å°æ¸¸ç åŒ  - å¤šäººåœ¨çº¿æ¸¸æˆæœåŠ¡ç«¯æ¡†æ¶</p>
            <p style="margin-top: 10px; font-size: 0.9em; opacity: 0.8;">
                åŸºäº Colyseus + TypeORM + Redis + JWT æ„å»º
            </p>
        </div>
    </div>

    <script>
        // å­˜å‚¨è®¿é—®ä»¤ç‰Œå’Œåˆ·æ–°ä»¤ç‰Œ
        let accessToken = localStorage.getItem('accessToken') || '';
        let refreshToken = localStorage.getItem('refreshToken') || '';

        // API è°ƒç”¨å‡½æ•°
        async function tryApi(method, endpoint, data = null, needAuth = false) {
            const url = endpoint;
            const options = {
                method: method,
                headers: {
                    'Content-Type': 'application/json',
                }
            };

            if (needAuth) {
                if (!accessToken) {
                    const token = prompt('è¯·è¾“å…¥è®¿é—®ä»¤ç‰Œ (Access Token):');
                    if (token) {
                        accessToken = token;
                        localStorage.setItem('accessToken', token);
                    } else {
                        alert('éœ€è¦è®¿é—®ä»¤ç‰Œæ‰èƒ½è°ƒç”¨æ­¤æ¥å£');
                        return;
                    }
                }
                options.headers['Authorization'] = `Bearer ${accessToken}`;
            }

            if (data && method !== 'GET') {
                options.body = JSON.stringify(data);
            }

            try {
                const response = await fetch(url, options);
                const result = await response.json();
                
                // å¦‚æœç™»å½•æˆåŠŸï¼Œä¿å­˜ä»¤ç‰Œ
                if (endpoint === '/api/auth/login' && result.success && result.data?.tokens) {
                    accessToken = result.data.tokens.accessToken;
                    refreshToken = result.data.tokens.refreshToken;
                    localStorage.setItem('accessToken', accessToken);
                    localStorage.setItem('refreshToken', refreshToken);
                    alert('ç™»å½•æˆåŠŸï¼è®¿é—®ä»¤ç‰Œå’Œåˆ·æ–°ä»¤ç‰Œå·²ä¿å­˜');
                }

                // æ˜¾ç¤ºå“åº”ç»“æœ
                alert('å“åº”ç»“æœï¼š\n\n' + JSON.stringify(result, null, 2));
                console.log('API å“åº”:', result);
            } catch (error) {
                alert('è¯·æ±‚å¤±è´¥ï¼š' + error.message);
                console.error('API é”™è¯¯:', error);
            }
        }

        // åˆ·æ–°ä»¤ç‰Œå‡½æ•°
        async function tryRefreshToken() {
            // ä» localStorage è·å–åˆ·æ–°ä»¤ç‰Œ
            const storedRefreshToken = localStorage.getItem('refreshToken');
            
            if (!storedRefreshToken) {
                const userInput = confirm('æœªæ‰¾åˆ°åˆ·æ–°ä»¤ç‰Œã€‚\n\næ˜¯å¦å…ˆè¿›è¡Œç™»å½•ä»¥è·å–åˆ·æ–°ä»¤ç‰Œï¼Ÿ\n\nç‚¹å‡»"ç¡®å®š"å°†è·³è½¬åˆ°ç™»å½•æ¥å£ï¼Œç‚¹å‡»"å–æ¶ˆ"å¯ä»¥æ‰‹åŠ¨è¾“å…¥åˆ·æ–°ä»¤ç‰Œã€‚');
                if (userInput) {
                    // æç¤ºç”¨æˆ·å…ˆç™»å½•
                    alert('è¯·å…ˆä½¿ç”¨"ç”¨æˆ·ç™»å½•"æ¥å£è¿›è¡Œç™»å½•ï¼Œç™»å½•æˆåŠŸåä¼šè‡ªåŠ¨ä¿å­˜åˆ·æ–°ä»¤ç‰Œã€‚');
                    return;
                } else {
                    // å…è®¸ç”¨æˆ·æ‰‹åŠ¨è¾“å…¥åˆ·æ–°ä»¤ç‰Œ
                    const token = prompt('è¯·è¾“å…¥åˆ·æ–°ä»¤ç‰Œ (Refresh Token):');
                    if (!token) {
                        return;
                    }
                    refreshToken = token;
                }
            } else {
                refreshToken = storedRefreshToken;
            }

            try {
                const response = await fetch('/api/auth/refresh', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        refreshToken: refreshToken
                    })
                });

                const result = await response.json();

                if (result.success && result.data) {
                    // æ›´æ–°ä¿å­˜çš„ä»¤ç‰Œ
                    accessToken = result.data.accessToken;
                    refreshToken = result.data.refreshToken;
                    localStorage.setItem('accessToken', accessToken);
                    localStorage.setItem('refreshToken', refreshToken);
                    alert('åˆ·æ–°ä»¤ç‰ŒæˆåŠŸï¼\n\næ–°çš„è®¿é—®ä»¤ç‰Œå’Œåˆ·æ–°ä»¤ç‰Œå·²ä¿å­˜ã€‚');
                } else {
                    alert('åˆ·æ–°ä»¤ç‰Œå¤±è´¥ï¼š' + (result.message || 'æœªçŸ¥é”™è¯¯'));
                }

                // æ˜¾ç¤ºå®Œæ•´å“åº”ç»“æœ
                console.log('åˆ·æ–°ä»¤ç‰Œå“åº”:', result);
            } catch (error) {
                alert('è¯·æ±‚å¤±è´¥ï¼š' + error.message);
                console.error('åˆ·æ–°ä»¤ç‰Œé”™è¯¯:', error);
            }
        }

        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥æœåŠ¡çŠ¶æ€
        window.addEventListener('load', async () => {
            try {
                const response = await fetch('/health');
                const data = await response.json();
                if (data.success) {
                    console.log('æœåŠ¡è¿è¡Œæ­£å¸¸:', data);
                }
            } catch (error) {
                console.error('æœåŠ¡è¿æ¥å¤±è´¥:', error);
            }
        });
    </script>
</body>
</html>

